<html>
	<meta>
		<link href="/weather/style/bootstrap.css" rel="stylesheet">
		<link href="/weather/style/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
	  	<script src="/weather/javascript/jquery-1.10.2.js"></script>
	  	<script src="/weather/javascript/jquery-ui-1.10.4.custom.min.js"></script>
	  	<script src="/weather/javascript/moment.min.js"></script>
		<script type="text/javascript" src="/weather/googlemaps">
		</script>	  	
	  	<style type="text/css">
			.ui-autocomplete-loading { background:url('/weather/images/ui-anim_basic_16x16.gif') no-repeat right center }
	  	</style>
		<script type="text/javascript">

			function initializeRequiredFields(){
				$( ":text" ).each(function(){
					$(this).css({border: "1px solid #cccccc"});
				});
			}

			function loaded(){
				$( "#loading" ).hide();
			}
			function loading(){
				$('#response').html("");
				$('#map-canvas').html("");
				$( "#loading" ).show(); 
			}

			$(function(){
				$.ajaxSetup({ scriptCharset: "utf-8" , contentType: "application/json; charset=utf-8"});
				loaded();

				$("#city").focus(function(){
					this.select();		
				});


				$("#city").autocomplete({
					source: function (request, response){
						//console.log(request);
						data = {};
						data.city = request.term;
						$.ajax({
					          url: "/weather/city/list",
						   	  type: 'POST',
					          data: JSON.stringify(data),
					          success: function( data ) {
					            response( $.map( data.cities, function( item ) {
					            	//console.log("item: " + item);
					              return {
					                label: item,
					                value: item
					              }
					            }));
					          }
						});
					},
					minLength:3,
					select: function (event, ui) {
						 var selectedObj = ui.item;
						 jQuery("#city").val(selectedObj.value);
						 return false;
					}
				}).removeClass("ui-corner-all").addClass("ui-corner-top");
				$("#city").autocomplete("option", "delay", 100);
			});  			 		
		</script>
	</meta>
	<body>
		<form data-bind="submit: getForecast">
			<label for="city"><h2>City</h2></label>
			<p><input data-bind="value: city, valueUpdate:'blur'" id="city"/></p>
			<p><button type="submit">Send</button></p>
		</form>
		<img id="loading" src="/weather/images/loading.gif" alt="">
		<div data-bind="with: forecast" id="response">
			<h3><span data-bind="text: name"></span>, <span data-bind="text: sys.country"></span></h3>
			<img data-bind="attr:{ src: 'http://openweathermap.org/img/w/' + weather[0].icon + '.png' }" />
			<span data-bind="text: main.temp"></span>°C </h2>
			<span data-bind="text: weather[0].description"></span>
			(<span data-bind="text: weather[0].main"></span>)
			<p></p>
			last update at <span data-bind="text: dt"></span>
			<p></p>
			<div class="span4">
				<table class="table table-striped table-bordered table-condensed">
					<tbody>
						<tr>
							<td>Wind</td>
				 			<td> <span data-bind="text: wind.speed"></span> m/s</td>
						</tr>
						<tr>
							<td>Cloudiness</td>
							<td> <span data-bind="text: clouds.all"></span> %</td>
						</tr>
						<tr>
							<td>Pressure</td>
							<td> <span data-bind="text: main.pressure"></span> hpa</td>
						</tr>
						<tr>
							<td>Humidity</td>
							<td><span data-bind="text: main.humidity"></span> %</td>
						</tr>
						<tr>
							<td>Minimum Temp</td>
							<td><span data-bind="text: main.temp_min"></span> °C</td>
						</tr>
						<tr>
							<td>Maximum Temp</td>
							<td><span data-bind="text: main.temp_max"></span> °C</td>
						</tr>
<!--  						<tr>
							<td>Rain (mm/3 hour)</td>
							<td data-bind="text: rain['3h']"></td>
						</tr>
 -->
 <!-- 						<tr>
							<td>Snow (mm/3 hour)</td>
							<td data-bind="text: snow['3h']"></td>
						</tr>
 -->						<tr>
							<td>Sunrise</td>
							<td data-bind="text: sys.sunrise"></td>
						</tr>
						<tr>
							<td>Sunset</td>
							<td data-bind="text: sys.sunset"></td>
						</tr>
					</tbody>
				</table>
			</div>				
		</div>
		<div id="map-canvas" style="width:400px; height:300px;"></div>
	  	<script src="/weather/javascript/knockout-3.2.0.js"></script>
	  	<script src="/weather/javascript/forecast_mvvm.js"></script>
		<script src="/weather/javascript/map_mvvm.js"></script>
	</body>
</html>